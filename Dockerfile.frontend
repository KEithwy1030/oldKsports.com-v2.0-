FROM node:22-alpine AS build

LABEL "language"="nodejs"

WORKDIR /app

# 接收构建时环境变量（Zeabur 自动注入）
ARG VITE_API_URL
ENV VITE_API_URL=${VITE_API_URL}

# 构建前端
COPY client/package*.json ./client/
WORKDIR /app/client
RUN npm install
COPY client/ ./
RUN npm run build

# 使用 nginx 提供静态文件服务
FROM nginx:alpine

# 复制 nginx 配置
COPY client/nginx.conf /etc/nginx/nginx.conf

# 复制构建产物
COPY --from=build /app/client/dist /usr/share/nginx/html

EXPOSE 8080

CMD ["nginx", "-g", "daemon off;"]

